<!DOCTYPE html>
<html lang="ml">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Live Local Body Election Results</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Font -->
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Noto+Sans+Malayalam:wght@100..900&display=swap");

        body {
            font-family: "Noto Sans Malayalam", sans-serif;
            background-color: #f0f4f8;
        }

        .widget-container {
            max-width: 1000px;
            margin: 20px auto;
            border: 2px solid #3b82f6;
            border-radius: 12px;
            background-color: white;
            overflow: hidden;
        }

        .widget-banner img {
            width: 100%;
            height: auto;
            display: block;
        }

        .live-result-button {
            width: 100%;
            padding: 10px;
            background-color: #dc2626;
            color: white;
            font-weight: 800;
            font-size: 1.1rem;
            cursor: pointer;
        }

        .live-dot {
            height: 12px;
            width: 12px;
            background-color: #10b981;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            position: relative;
        }

        .live-dot::after {
            content: "";
            position: absolute;
            height: 100%;
            width: 100%;
            background-color: #10b981;
            border-radius: 50%;
            animation: pulse 1.4s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.9; }
            100% { transform: scale(2.2); opacity: 0; }
        }

        .result-panels {
            overflow: hidden;
            max-height: 0;
            opacity: 0;
            transition: max-height .6s ease, opacity .6s ease;
        }

        .result-panels.open {
            max-height: 2000px;
            opacity: 1;
        }

        .party-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            padding: 10px;
        }

        .party-box {
            background: white;
            text-align: center;
            padding: 10px 0;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }

        .panchayath-header { background: #ef4444; }
        .corporation-header { background: #22c55e; }
        .nagarasabha-header { background: #3b82f6; }
        .block-panchayath-header { background: #f97316; }
        .jilla-panchayath-header { background: #8b5cf6; }

        .party-name { font-weight: 700; }
        .count { font-size: 1.8rem; font-weight: 800; }
        
        .ldf-tint { background: #fef2f2; }
        .udf-tint { background: #eff6ff; }
        .nda-tint { background: #fffbeb; }
        .oth-tint { background: #f3f4f6; }

        .ldf-count { color: #dc2626; }
        .udf-count { color: #1d4ed8; }
        .nda-count { color: #fbbf24; }
        .oth-count { color: #6b7280; }
    </style>
</head>

<body>

<div class="widget-container">

    <!-- ⭐ BANNER RESTORED -->
    <div class="widget-banner">
        <img src="https://images.assettype.com/newsmalayalam/2025-11-14/3ola6enc/local-body-poll-banner"
             alt="Election Banner"
             onerror="this.src='https://placehold.co/1000x250/000/fff?text=Election+Banner';">
    </div>

    <!-- Toggle button -->
    <!-- <button id="toggleButton" class="live-result-button">
        <span class="live-dot"></span>
        LIVE RESULT CLICK HERE ▼
    </button> -->

    <div id="dataStatus"
         class="text-center text-xs py-1 bg-gray-100 text-gray-500">
        Google Sheet ഡാറ്റ ലോഡ് ചെയ്യുന്നു...
    </div>

    <!-- RESULT PANELS -->
    <div id="resultPanels open" class="result-panels">

        <!-- Panchayath -->
        <div>
            <div class="panchayath-header text-white font-bold p-3 flex justify-between">
                <span>പഞ്ചായത്ത്</span><span>Total 941</span>
            </div>
            <div class="party-grid" data-body="Panchayath">
                <div class="party-box ldf-tint"><div class="party-name">LDF</div><div class="count ldf-count">0</div></div>
                <div class="party-box udf-tint"><div class="party-name">UDF</div><div class="count udf-count">0</div></div>
                <div class="party-box nda-tint"><div class="party-name">NDA</div><div class="count nda-count">0</div></div>
                <div class="party-box oth-tint"><div class="party-name">OTH</div><div class="count oth-count">0</div></div>
            </div>
        </div>

        <!-- Corporation -->
        <div>
            <div class="corporation-header text-white font-bold p-3 flex justify-between">
                <span>കോർപ്പറേഷൻ</span><span>Total 6</span>
            </div>
            <div class="party-grid" data-body="Corporation">
                <div class="party-box ldf-tint"><div class="party-name">LDF</div><div class="count ldf-count">0</div></div>
                <div class="party-box udf-tint"><div class="party-name">UDF</div><div class="count udf-count">0</div></div>
                <div class="party-box nda-tint"><div class="party-name">NDA</div><div class="count nda-count">0</div></div>
                <div class="party-box oth-tint"><div class="party-name">OTH</div><div class="count oth-count">0</div></div>
            </div>
        </div>

        <!-- Nagarasabha -->
        <div>
            <div class="nagarasabha-header text-white font-bold p-3 flex justify-between">
                <span>നഗരസഭ</span><span>Total 87</span>
            </div>
            <div class="party-grid" data-body="Nagarasabha">
                <div class="party-box ldf-tint"><div class="party-name">LDF</div><div class="count ldf-count">0</div></div>
                <div class="party-box udf-tint"><div class="party-name">UDF</div><div class="count udf-count">0</div></div>
                <div class="party-box nda-tint"><div class="party-name">NDA</div><div class="count nda-count">0</div></div>
                <div class="party-box oth-tint"><div class="party-name">OTH</div><div class="count oth-count">0</div></div>
            </div>
        </div>

        <!-- Block Panchayath -->
        <div>
            <div class="block-panchayath-header text-white font-bold p-3 flex justify-between">
                <span>ബ്ലോക്ക് പഞ്ചായത്ത്</span><span>Total 152</span>
            </div>
            <div class="party-grid" data-body="Block Panchayat">
                <div class="party-box ldf-tint"><div class="party-name">LDF</div><div class="count ldf-count">0</div></div>
                <div class="party-box udf-tint"><div class="party-name">UDF</div><div class="count udf-count">0</div></div>
                <div class="party-box nda-tint"><div class="party-name">NDA</div><div class="count nda-count">0</div></div>
                <div class="party-box oth-tint"><div class="party-name">OTH</div><div class="count oth-count">0</div></div>
            </div>
        </div>

        <!-- Jilla Panchayath -->
        <div>
            <div class="jilla-panchayath-header text-white font-bold p-3 flex justify-between">
                <span>ജില്ല പഞ്ചായത്ത്</span><span>Total 14</span>
            </div>
            <div class="party-grid" data-body="District Panchayat">
                <div class="party-box ldf-tint"><div class="party-name">LDF</div><div class="count ldf-count">0</div></div>
                <div class="party-box udf-tint"><div class="party-name">UDF</div><div class="count udf-count">0</div></div>
                <div class="party-box nda-tint"><div class="party-name">NDA</div><div class="count nda-count">0</div></div>
                <div class="party-box oth-tint"><div class="party-name">OTH</div><div class="count oth-count">0</div></div>
            </div>
        </div>

    </div>
</div>

<script>
/*********************
   Toggle Button Functionality
**********************/
document.addEventListener("DOMContentLoaded", () => {
    const toggleButton = document.getElementById("toggleButton");
    const resultPanels = document.getElementById("resultPanels");

    toggleButton.addEventListener("click", () => {
        resultPanels.classList.toggle("open");

        const arrow = resultPanels.classList.contains("open") ? "▲" : "▼";

        toggleButton.innerHTML = `
            <span class="live-dot"></span>
            LIVE RESULT CLICK HERE ${arrow}
        `;
    });
});
</script>

<script>
/*********************
   Sheet → Widget Mapping
**********************/
const bodyNameMap = {
    "Panchayat": "പഞ്ചായത്ത്",
    "Corporation": "കോർപ്പറേഷൻ",
    "Nagarasabha": "നഗരസഭ",
    "Block Pan": "ബ്ലോക്ക് പഞ്ചായത്ത്",
    "District Pan": "ജില്ല പഞ്ചായത്ത്"
};

/*********************
   Fetch Google Sheet
**********************/
async function fetchGoogleSheetData() {
    const url =
        "https://docs.google.com/spreadsheets/d/1reobM7KwPkNCHZbN3g8G5GkAFWEAtJ-G7pjHG2UH7vQ/gviz/tq?tqx=out:json";

    const response = await fetch(url);
    const text = await response.text();

    const json = JSON.parse(text.substring(47, text.length - 2));

    return json.table.rows.map(r => {
        const rawBody = r.c[0]?.v?.trim() || "";

        return {
            BODY: rawBody,
            LDF: r.c[2]?.v || 0,
            UDF: r.c[3]?.v || 0,
            NDA: r.c[4]?.v || 0,
            OTH: r.c[5]?.v || 0
        };
    });
}


/*********************
   Update UI
**********************/
function updateResults(data) {
    data.forEach(item => {
        const grid = document.querySelector(`.party-grid[data-body='${item.BODY}']`);
        if (!grid) return;

        grid.querySelector(".ldf-count").textContent = item.LDF;
        grid.querySelector(".udf-count").textContent = item.UDF;
        grid.querySelector(".nda-count").textContent = item.NDA;
        grid.querySelector(".oth-count").textContent = item.OTH;
    });
}

/*********************
   Load Sheet Data
**********************/
async function loadData() {
    try {
        const data = await fetchGoogleSheetData();
        updateResults(data);

        const now = new Date();
        const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });

        document.getElementById("dataStatus").textContent =
            `Last Updated: ${timeString}`;
    } catch (e) {
        document.getElementById("dataStatus").textContent =
            "ഡാറ്റ ലോഡ് ചെയ്യുന്നതിൽ പിശക്.";
        console.error(e);
    }
}

// Initial load + auto-refresh every 30 seconds
document.addEventListener("DOMContentLoaded", () => {
    loadData();
    setInterval(loadData, 10000); // 30 seconds
});

</script>

</body>
</html>
